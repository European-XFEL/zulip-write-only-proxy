{% extends 'base.html' %}

<!-- Content -->
{% block content %}
<div>
  <span class="label label-text">Admin Token:</span>
  <input type="password" class="input input-bordered w-full" id="token" />
</div>
<div class="form-control w-full">
  <button
    class="btn"
    id="loginBtn"
    hx-get="/me"
    hx-push-url="true"
    hx-swap="outerHTML"
    hx-target="#content"
    hx-select="#content"
  >
    <div class="loading loading-spinner htmx-indicator"></div>
    Login
  </button>
</div>

<script>
  document.body.addEventListener("htmx:configRequest", function (e) {
    if (e.detail.headers == null) {
      e.detail.headers = {};
    }
    e.detail.headers["auth_token"] = document.getElementById("token").value;
  });
</script>

<!-- <script>
  document.body.addEventListener("htmx:confirm", function (evt) {
    evt.preventDefault();
    swal({
      title: "Are you sure?",
      text: "Are you sure you are sure?",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    }).then((confirmed) => {
      if (confirmed) {
        evt.detail.issueRequest();
      }
    });
  });
  let authSuccess = false;
  let authToken = null;

  htmx.on("htmx:confirm", (e) => {
    if (!authSuccess) {
      let authToken = document.getElementById("token").value;
      e.detail.headers = {};
      e.detail.headers["X-API-key"] = _authToken;
    }
    authSuccess = htmx.ajax("GET", "/me");
    if (authSuccess) {
      authToken = _authToken;
    } else {
      e.preventDefault();
    }
  });

  htmx.on("htmx:configRequest", (e) => {
    e.detail.headers["AUTH"] = authToken;
  });
</script> -->
{% endblock %}
